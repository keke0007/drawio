# 装饰器案例

## 一、装饰器的理解

### 1、闭包

要想了解装饰器，首先要了解一个概念，闭包。什么是闭包，一句话说就是，在函数中再嵌套一个函数，并且引用外部函数的变量，这就是一个闭包了。

### 2、什么是装饰器？

其实装饰器就是一个闭包，装饰器是闭包的一种应用。什么是装饰器呢，简言之，python装饰器就是用于拓展原来函数功能的一种函数，这个函数的特殊之处在于它的返回值也是一个函数，使用python装饰器的好处就是在不用更改原函数的代码前提下给函数增加新的功能。使用时，再需要的函数前加上@demo即可。

### 3、为何要用装饰器

开放封闭原则
开放：指的是对拓展功能是开放的
封闭：指的是对修改源代码是封闭的
**装饰器就是在不修改被装饰器对象源代码以及调用方式的前提下为被装饰对象添加新功能**

## 二、案例一：给多个函数，增加一个：输出函数执行时间的功能

```python
import time
from functools import wraps


def timer(func):
    # @wraps(func)
    def inner():
        start_time = time.time()
        func()
        wait_time = time.time() - start_time
        print("%s 运行时间:" % func.__name__, wait_time)

    return inner

@timer
def test_1():
    time.sleep(1)
    print("test1")


def test_2():
    time.sleep(2)
    print("test2")

@timer
def test_3():
    time.sleep(3)
    print("test3")

test_3()
print(test_3.__name__)
```

## 三、案例二

需求：**编写装饰器，为多个函数加上认证功能（用户的账户密码来源于文件），要求登录成功一次，后续的函数都无需再输入用户名和密码，直接可以执行。要求：文件名可以自定义。**

```python
import os, time, sys
from functools import wraps

user_status = False


def login(users_path):
    def login_decorator(func):
        if os.path.exists(users_path):
            with open(file=users_path, mode='r+', encoding='utf-8') as file:
                line = file.read()
                user_info = eval(line)

        else:
            with open(users_path, mode='w', encoding='utf-8') as file:
                choice = input("是否注册用户？[Y/N]")
                if choice == 'Y' or choice == 'y':
                    name = input("请输入新用户用户名：")
                    password = input("请输入新用户密码：")
                    user_info = {'name': name, 'password': password}
                    row = str(user_info)
                    file.write(row)
                else:
                    print('没有用户信息，程序退出')
                    sys.exit(2)

        @wraps(func)
        def inner():
            _username = user_info['name']
            _password = user_info['password']
            global user_status
            if user_status is False:
                username = input("输入用户名：")
                password = input("密码：")
                if username == _username and password == _password:
                    print(f"欢迎{username}登录...")
                    user_status = True
                else:
                    print("用户名或者密码错误")
            if user_status:
                func()

        return inner

    return login_decorator


@login('users.txt')
def test_1():
    time.sleep(1)
    print("test1")


@login('users.txt')
def test_2():
    time.sleep(2)
    print("test2")


@login('users.txt')
def test_3():
    time.sleep(3)
    print("test3")


test_3()
test_2()
test_1()

```
